---
layout: default     
title: MP2&mdash; Text Categorization   
category: mps    
permalink: mps/mp2.html    
published: true    
---

This assignment is designed to help you practice with general steps in building a text categorization system. It  consists of four parts, including feature selection, building Naive Bayes classifier, kNN classifier, and classification performance evaluation, totaling 100 points.

<!--snippet-->

* **Task 1: [Feature Selection](#fv)** *(30 points)*: implement two basic feature selection methods, i.e., Information Gain and Chi Square test, for selecting high-quality text features;  
* **Task 2: [Naive Bayes](#nb)** *(20 points)*: build a Naive Bayes classifier for text document classification;
* **Task 3: [k Nearest Neighbor](#knn)** *(20 points)*: build a k Nearest Neighbor classifier for text document classification;
* **Task 4: [Classification performance evaluation](#eval)** *(30 points)*: evaluate the constructed classifiers with standard classification performance metrics, including precision, recall and F-measure.  

The deadline and submission guidance are explicitly described [here](#time).

# Data Set

We will use the same small Yelp review data set as we used for MP1 on the CS lab servers (e.g., *labunix01.cs.virginia.edu*, *labunix02.cs.virginia.edu*, *labunix03.cs.virginia.edu*):

	"/home/hw5x/TextMining/MP1/data/Yelp_Small" 

More details of this review data set can be found in our previous [MP1 description]({{site.baseurl}}/mps/mp1.html).

Please reuse your implementation for MP1 as much as possible; and based that, you should be able to finish this assignment without too much effort. 

*HINT: since we have provided a sample solution provided by Mohammad Al Boni, you can refer to that sample implementation to solve the following MP2 tasks.* 

# <a name="preparation"></a>Preparation: Creating the training and testing corpus

## Terminologies

We will keep using the same terminologies as we used in MP1. 

- **Document**: it refers to each individual Yelp review document contained in the json file. Therefore, one json file might contain multiple review documents.                
- **Restaurant**: it refers to a specific restaurant entity contained in the given review data set. It is uniquely identified by the corresponding Yelp ID; and one json for one restaurant.            
- **DF/IDF/TF/TTF/Cosine similarity**: the definitions for those metrics strictly follow those on our lecture slides, unless specifically defined below.

## Basic text processing techniques

We will use the same text processing techniques as we have explored in MP1, including tokenization, stemming, normalization and stopword removal (please use the standard [Smart system's stopword list](http://jmlr.org/papers/volume5/lewis04a/a11-smart-stop-list/english.stop)). More action details can be found in our previous [description of MP1]({{site.baseurl}}/mps/mp1.html). Note, in all the following tasks, we will only use **unigram as our features** and **json files in the train folder**.   

## Defining the classes

For each review document in this data set, it is associated with a numeric overall rating in the range of 1 to 5. We will treat the review documents with overall ratings **below 4 as negative (labeled as 0)** and **the rest as positive (labeled as 1)**. As a result, we have created a binary text classification problem. 

# <a name="fv"></a>Task 1: Feature Selection (30pts)      

Based on the basic text processing steps we have taken in MP1, we have created the vector representation for every review document in our collection. Next we will implement two most effective text feature selection methods, i.e., Information Gain and Chi Square, to further refine this representation.

The definitions of Information Gain and Chi Square feature selector are as follows (please also refer to our lecture slides),

$$ IG(t) = -\sum\_{y=\{1,2\}} p(y)\log p(y) + p(t)\sum\_{y=\{1,2\}} p(y|t)\log p(y|t) + p(\bar t)\sum\_{y=\{1,2\}} p(y|\bar t)\log p(y|\bar t) $$,
where $p(y=1|t)$ is the probability that we get a positive document where we observe the term t, and $p(y=1|\bar t)$ is the probability that we get a positive document where we do not observe the term t.

**Note**: here we need to define $0\log 0=0$ to avoid zero probabilities in entropy computation.  

$$\chi^2(t) = \frac{(A+B+C+D)(AD-BC)}{(A+C)(B+D)(A+B)(C+D)} $$, 
where A is the number of positive documents containing term t, B is the number of positive documents not containing term t, C is the number of negative documents containing term t, and D is the number of positive documents not containing term t.

Before we apply these two feature selection methods, we will perform prefiltering of features by DF. We will use the same threshold **50** as in MP1, i.e., removing the terms with DF smaller than 50. 

As required in Chi Square, we will use the threshold **3.841** to filter out the insignificant terms, i.e., removing the terms whose $\chi^2(t)<3.841$.

After this filtering steps, rank the left features by their $IG(t)$ value and $\chi^2(t)$ value in descending orders accordingly. We will choose the top 5000 words from each of these two ordered lists as our candidate features. If we don't have 5000 features left in Chi Square selection, return whatever you got after filtering.

Before moving onto the next task, merge the feature lists you have got from Information Gain and Chi Square, i.e., take the union of these two sets of top 5000 features, and use the resulting list as the finalized features (i.e., controlled vocabulary) for the following tasks. Use this controlled vocabulary to construct the vector representation for all the review documents in the train folder, and **ignore** the documents with less or equal to five non-zero features (i.e., length of the resulting sparse vector less or equal to 5). We will refer to the resulting document collection as **corpus** in our following descriptions.

**What to submit**:

1. List of the top 20 words selected by Information Gain and Chi Square accordingly. What is the size of your finalized feature set after merging? How many review documents are there in the resulting corpus after feature selection? (10 pts).
2. Paste your code for Information Gain and Chi Square computation (2$\times$10 pts).

# <a name="nb"></a>Part2: Naive Bayes (20pts)

### 2.1 Training Naive Bayes with Maximum a Posterior estimator (10pts)

As we discussed in the course lecture, Naive Bayes classifier for text categorization problem can be considered as estimating independent N-gram language models for each class. In this assignment, we will use unigram language model with additive smoothing (set $\delta=0.1$) to estimate parameters in a Naive Bayes text classifier.
 
You are suggested to reuse your implementation in MP1 for unigram language models in this task. 

*HINT: you only need to estimate two unigram language models for positive and negative classes accordingly, and $p(c)$ is simply the ratio of the two classes in the corpus.* 

**What to submit**:

1. Use the whole corpus to estimate a Naive Bayes classifier. Compute the log ratio between $p(w|c=1)$ and $p(w|c=0)$, i.e., $\log\frac{p(w|c=1)}{p(w|c=0)}$, and rank the features in a descending order with respect to this ratio. List of the top 20 and bottom 20 words from the above ranked list. Do they make sense to you in terms of distinguishing the positive opinion from negative opinion? (10 pts).

### 2.2 Naive Bayes as a linear classifier (10pts)

As discussed in our lecture slides, Naive Bayes for binary classification boils down to be a linear classification model:

$$f(X)=\log\frac{p(y=1|X)}{p(y=0|X)})=\log\frac{p(c=1)}{p(c=0)} + \sum\_x(\log p(x|y=1) - \log p(x|y=0))$$, and $$\bar y=sgn(f(X))$$
where $sgn(x)=1$ if $x\ge1$, otherwise 0. 

Implement this prediction function in your Naive Bayes. It should take a document as input and output its predicted class label. 

**What to submit**:
1. Compute $f(X)$ over all the documents in the corpus and rank them in a descending order with respect to $f(X)$. Plot the 

# <a name="time"></a>Deadlines & How to submit

MP2 is due on **Apr. 16th 11:55pm***. You have in total 7 days to finish this MP. The late policy for all our homework assignments has been carefully discussed in the course syllabus.

Collab assignment page has been created for this MP. Please submit your written report strictly following the requirement specified above. The report **must be in PDF** format.    